(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[473],{6421:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return l}});var t=o(159),r=o(219),a=(o(7294),o(3905)),s=["components"],i={};function l(e){var n=e.components,o=(0,r.Z)(e,s);return(0,a.kt)("wrapper",(0,t.Z)({},i,o,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"tutorial"},"Tutorial"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"yarn add rsrc\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Requires ",(0,a.kt)("inlineCode",{parentName:"p"},"react@>=16.8"),".\nThe ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch"},"fetch\nAPI"),"\nwill also need to be natively supported or polyfilled for your target\nenvironments.")),(0,a.kt)("h2",{id:"configure-a-cache-provider"},"Configure a cache provider"),(0,a.kt)("p",null,"The cache provider accepts a single, optional prop called ",(0,a.kt)("inlineCode",{parentName:"p"},"map"),", which defaults\nto ",(0,a.kt)("inlineCode",{parentName:"p"},"new Map()"),". The value is expected to expose a\n",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"},"map"),"\nor map-like interface \u2014 meaning it is iterable and provides methods for\n",(0,a.kt)("inlineCode",{parentName:"p"},"get()"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"set()"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"delete()"),"."),(0,a.kt)("p",null,"For larger applications, you might want to consider a ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)"},"least recently used\n(LRU)"),"\nimplementation like ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/quick-lru"},"quick-lru")," which\ncan help limit memory usage."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'// index.js\n\nimport React from "react";\nimport { render } from "react-dom";\nimport { Router } from "@reach/router";\nimport { Cache } from "rsrc";\nimport LRU from "quick-lru";\nimport Todos from "./pages/Todos";\n\nconst lru = new LRU({ maxSize: 100 });\n\nconst App = () => (\n  <Cache map={lru}>\n    <Router>\n      <Todos path="/todos" />\n    </Router>\n  </Cache>\n);\n\nrender(<App />, document.getElementById("root"));\n')),(0,a.kt)("h2",{id:"define-a-resource"},"Define a resource"),(0,a.kt)("p",null,"A resource can be thought of as a component-level description of an API endpoint\nand its available methods. In most cases this will mirror the interface provided\nby the endpoint itself along with any related operations that might be useful when\ndealing with the resource."),(0,a.kt)("p",null,"In the example below, we have an endpoint at ",(0,a.kt)("inlineCode",{parentName:"p"},"/todos"),". While a ",(0,a.kt)("inlineCode",{parentName:"p"},"GET"),' request to\nthis endpoint could return a collection of "todos", it\'s likely designed to\naccommodate additional operations (',(0,a.kt)("inlineCode",{parentName:"p"},"POST"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"PATCH"),", etc). We can define these\nmethods as seen in the ",(0,a.kt)("inlineCode",{parentName:"p"},"actions")," prop below."),(0,a.kt)("p",null,"For actions that modify a resource, you can provide an additional argument to\nautomatically invalidate related resources when the action resolves\nsuccessfully."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'// resources/todos/Resource.js\n\nimport React from "react";\nimport { Resource } from "rsrc";\n\nexport default ({ children }) => {\n  const url = "https://api.example.com/todos";\n  const options = {\n    headers: {\n      "Content-Type": "application/json",\n    },\n  };\n  const actions = {\n    create: (data) => ({\n      options: {\n        ...options,\n        method: "POST",\n        body: JSON.stringify(data),\n      },\n      invalidates: [url],\n    }),\n    markComplete: (id) => ({\n      url: `${url}/{id}`,\n      options: {\n        ...options,\n        method: "PATCH",\n        body: JSON.stringify({ completed: true }),\n      },\n      invalidates: [url, `${url}/${id}`],\n    }),\n  };\n\n  return (\n    <Resource url={url} options={options} actions={actions}>\n      {children}\n    </Resource>\n  );\n};\n')),(0,a.kt)("h2",{id:"build-out-your-views"},"Build out your views"),(0,a.kt)("p",null,"A resource view is a component that has been tailored to consume a particular\nresource value."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'// resources/todos/List.js\n\nimport React from "react";\n\nexport default (props) => {\n  const { onSuccess, onFail, resource } = props;\n  const { state, actions } = resource;\n\n  if (state.pending) return "Loading...";\n\n  if (state.rejected) return `Error: ${state.reason.message}`;\n\n  const todos = state.value.filter((todo) => !todo.completed);\n\n  const handleClick = (id) => {\n    actions\n      .markcomplete(id)\n      .then((value) => {\n        onSuccess(value);\n      })\n      .catch((error) => {\n        onFail(error);\n      });\n  };\n\n  return (\n    <ul>\n      {todos.map((todo) => (\n        <li key={todo.id}>\n          <button onClick={() => handleClick(todo.id)}>\u2714</button>\n          {todo.title}\n        </li>\n      ))}\n    </ul>\n  );\n};\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'// resources/todos/Create.js\n\nimport React from "react";\nimport TodosForm from "./Form";\n\nexport default (props) => {\n  const { onSuccess, onFail, resource } = props;\n  const { state, actions } = resource;\n\n  const handleSubmit = (formValues) => {\n    actions\n      .create(formValues)\n      .then((value) => {\n        onSuccess(value);\n      })\n      .catch((error) => {\n        onFail(error);\n      });\n  };\n\n  return <TodosForm onSubmit={handleSubmit} />;\n};\n')),(0,a.kt)("h2",{id:"use-it-on-a-page"},"Use it on a page"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'// pages/Todos.js\n\nimport React from "react";\nimport { notify } from "../utils";\nimport { Todos, TodosList, TodosCreate } from "../resources/todos";\n\nexport default (props) => {\n  const handleSuccess = (value) => {\n    notify({ purpose: "success", message: `Success: ${value.id}` });\n  };\n\n  const handleFail = (error) => {\n    notify({ purpose: "error", message: `Fail: ${error.message}` });\n  };\n\n  return (\n    <Todos>\n      {(resource) => (\n        <>\n          <TodosCreate\n            resource={resource}\n            onSuccess={handleSuccess}\n            onFail={handleFail}\n          />\n          <TodosList\n            resource={resource}\n            onSuccess={handleSuccess}\n            onFail={handleFail}\n          />\n        </>\n      )}\n    </Todos>\n  );\n};\n')))}l.isMDXComponent=!0},5126:function(e,n,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/getting-started/tutorial",function(){return o(6421)}])}},function(e){e.O(0,[774,888,179],(function(){return n=5126,e(e.s=n);var n}));var n=e.O();_N_E=n}]);